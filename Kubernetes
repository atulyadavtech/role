##Docker Installation 
dpkg --configure -a
wget -O - https://get.docker.com | bash

## Enviorment Files
wget https://raw.githubusercontent.com/atulyadavtech/ganana/master/limits.conf -O /etc/security/limits.conf
wget https://raw.githubusercontent.com/atulyadavtech/Conf-Files/master/ssh-csh -O /etc/profile.d/ssh.csh
wget https://raw.githubusercontent.com/atulyadavtech/Conf-Files/master/ssh-sh -O /etc/profile.d/ssh.sh
wget https://raw.githubusercontent.com/atulyadavtech/Conf-Files/master/history-sh -O /etc/profile.d/history.sh

##Enable the br_netfilter module for cluster communication.
echo "net/bridge/bridge-nf-call-ip6tables = 1" >> /etc/ufw/sysctl.conf
echo "net/bridge/bridge-nf-call-iptables = 1" >> /etc/ufw/sysctl.conf
echo "net/bridge/bridge-nf-call-arptables = 1" >> /etc/ufw/sysctl.conf

modprobe br_netfilter
echo '1' > /proc/sys/net/bridge/bridge-nf-call-iptables

sysctl -p

## Swap Disbaled
sed -i -e 's|'/swap.img'|'#/swap.img'|' /etc/fstab

## Packages Installation 
apt-get install apt-transport-https curl nfs-kernel-server -y


## SUDO User Setup
echo "locuz ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers


##Kubernetes Installation

curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add
apt-add-repository "deb https://apt.kubernetes.io/ kubernetes-xenial main"


mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config

apt-get install kubeadm -y

kubeadm init --pod-network-cidr=172.31.4.0/20


mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config


kubectl config view

kubectl version

kubectl apply -f https://docs.projectcalico.org/v3.9/manifests/calico.yaml

kubectl get nodes

kubectl get deployments

kubectl get pods
